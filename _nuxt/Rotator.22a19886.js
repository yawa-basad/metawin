import{f as S,E as f,k as w,D as c,p as y,m as v,u as M,q as l,G as d,aP as $,n as r,al as I,_ as G,o as k,c as b,a as W,w as N,T as x,y as A,h as C}from"./entry.4421f2c3.js";const _=S({name:"PanelMessageRotator",setup(){return{websocketStore:f()}},props:["mode","slow"],data(){return{rotationPolling:null,initiated:!1,staticMessages:[],dynamicMessages:[],currentMessage:null,maxDynamicMessages:20,lastStaticId:null,greetings:["Greetings, [username]! Welcome to Metawin","Welcome, [username], to the world of Metawin","We're thrilled to have you, [username], here at Metawin","Step right up, [username], and welcome to Metawin!"],activeGreeting:0}},computed:{...w(c,["isUserLogged"]),...w(y,["userData"]),...v(M,["showLoginModal","chatState","navState","isMobileNavOpen"]),subscriptions(){return this.mode==="InstantGamePage"?["Activity:Games"]:["Activity:Sweepstakes","Activity:Games","Activity:Users","Sweepstakes"]}},mounted(){this.init()},beforeUnmount(){clearInterval(this.rotationPolling),this.rotationPolling=null,this.subscriptions.forEach(e=>{this.unsubscribe(e)})},methods:{...l(f,["subscribe","unsubscribe"]),...l(I,["openGameDirect"]),...l(M,["openWalletModal"]),init(){this.subscriptions.forEach(e=>{this.subscribe(e)}),this.websocketStore.$onAction(({name:e,args:s})=>{var t;e==="handleMessage"&&(s[0].type==="Activity"&&((t=this.userData)!=null&&t.id)&&(d({name:e,args:s},this.populateActivityMessage,"Activity","GameWin"),d({name:e,args:s},this.populateActivityMessage,"Activity","GameMultiWin")),s[0].type==="Sweepstake:Winner"&&d({name:e,args:s},this.populateSweepstakeWinnerMessage,"Sweepstake:Winner"))}),this.initiated||this.feedInit(),this.startPolling()},startPolling(){clearInterval(this.rotationPolling),this.rotationPolling=setInterval(()=>{this.setCurrentMessage()},this.slow?2e3:1e3)},feedInit(){this.reset(),this.populateStaticMessages(),this.setInitialMessage(),this.initiated=!0},setInitialMessage(){const e=c();this.currentMessage=this.staticMessages.find(s=>s.loggedIn==e.isUserLogged||s.loggedIn===void 0),this.lastStaticId=this.currentMessage.id},setCurrentMessage(){if(!this.currentMessage){this.setInitialMessage();return}if(this.dynamicMessages.length>0){this.currentMessage=this.dynamicMessages.shift();return}const e=c(),s=this.staticMessages.filter(t=>(t.loggedIn==e.isUserLogged||t.loggedIn===void 0)&&t.id!==this.lastStaticId);s.length>=1?(this.currentMessage=s[Math.floor(Math.random()*s.length)],this.lastStaticId=this.currentMessage.id):this.setInitialMessage()},populateActivityMessage(e){var s;if(!(this.mode==="InstantGamePage"&&(e==null?void 0:e.type)!=="GameWin")){if(e.type==="SweepstakeEntered"){let t="";if(e.data.prizes&&e.data.prizes.length>0){const a=e.data.prizes[0].item;a.type==="NFT"&&(t=this.$getNFTTokenNumber(a.name,a.tokenId))}const i=this.buildMessage("SweepstakeEntered",`<p class="w-full"> <strong class="text-yellow-500 uppercase tracking-wider">ENTRY</strong> ${e.displayName} entered ${e.data.name}${t?` #${t}`:""}</p>`,!1,e);this.dynamicMessages.push(i)}if(e.type==="UserCreated"){const t=this.greetings[this.activeGreeting].replace("[username]",e.displayName),i=this.buildMessage("UserCreated",`<p><strong class="text-cyan uppercase tracking-wider">CONNECT</strong> ${t}</p>`,!1,e);this.dynamicMessages.push(i),this.activeGreeting=this.activeGreeting===this.greetings.length-1?0:this.activeGreeting+1}if(e.type==="GameBet"){const t=this.$round(e.data.bet,4);let i=`${t} ${e.data.currencyCode}`;t||(i="a free spin");const a=this.buildMessage("GameBet",`<p><strong class="text-orange-500 uppercase tracking-wider">ENTRY</strong> ${e.displayName} entered ${e.data.name} with ${i}</p>`,!0,e);this.dynamicMessages.push(a)}if(e.type==="GameWin"){const t=this.$round(e.data.win,4),i=this.buildMessage("GameWin",`<p><strong class="text-green-500 uppercase tracking-wider">WIN</strong> ${e.displayName} won ${t} ${e.data.currencyCode} on ${e.data.name}</p>`,!0,e);this.dynamicMessages.push(i)}if(e.type==="GameMultiWin")for(const t of e.data.winners){const i=this.$round(t.amount,4),a=this.buildMessage("GameMultiWin",`<p><strong class="text-green-500 uppercase tracking-wider">WIN</strong> ${t.displayName} won ${i} ${t.currencyCode} on ${e.data.name}</p>`,!0,e);this.dynamicMessages.push(a)}this.ensureMaxDynamicBuffer(),((s=this.currentMessage)==null?void 0:s.type)==="Static"&&(this.setCurrentMessage(),this.startPolling())}},populateSweepstakeWinnerMessage(e){let s="";e.prize.type==="NFT"&&(s=e.prize.tokenId);const t=this.buildMessage("SweepstakeWin",`<p><strong class="text-green-500 uppercase tracking-wider">WIN</strong> ${e.displayName} won ${e.sweepstakeName}${s?` #${s}`:""}</p>`,!1,e);this.dynamicMessages.push(t),this.ensureMaxDynamicBuffer()},ensureMaxDynamicBuffer(){this.dynamicMessages.length>this.maxDynamicMessages&&this.dynamicMessages.shift()},populateStaticMessages(){this.staticMessages=[this.buildMessage("Static",'<p class="cursor-pointer"><strong class="text-white uppercase tracking-wider">NEW</strong> Earn 2.5% on all user Competition purchases from <span class="text-cyan">referrals</span></p>',!0,{redirect:"/referrals"},!1),this.buildMessage("Static",'<p class="cursor-pointer">Deposits and withdrawals are <strong class="text-white tracking-wider">instant</strong>. <span class="text-cyan">Swap Now!</span></p>',!0,{deposit:!0},!0)]},buildMessage(e,s,t,i,a){return{type:e,text:s,loginRequired:t,payload:i,id:$(),loggedIn:a}},async messageAction(){var s,t,i,a,o,n,h,u,g,p,m;const e=this.currentMessage;if(e!=null&&e.loginRequired&&!this.isUserLogged)return this.showLoginModal=!0;switch(e==null?void 0:e.type){case"Static":(s=e==null?void 0:e.payload)!=null&&s.redirect?await r((t=e==null?void 0:e.payload)==null?void 0:t.redirect):(i=e==null?void 0:e.payload)!=null&&i.deposit&&this.openWalletModal("deposit");break;case"SweepstakeEntered":await r(`/competition/${(o=(a=e==null?void 0:e.payload)==null?void 0:a.data)==null?void 0:o.id}`);break;case"UserCreated":await r(`/mw/${(h=(n=e==null?void 0:e.payload)==null?void 0:n.displayName)==null?void 0:h.toLowerCase()}`);break;case"GameBet":this.openGame((u=e==null?void 0:e.payload)==null?void 0:u.data);break;case"GameWin":this.openGame((g=e==null?void 0:e.payload)==null?void 0:g.data);break;case"GameMultiWin":this.openGame((p=e==null?void 0:e.payload)==null?void 0:p.data);break;case"SweepstakeWin":await r(`/competition/${(m=e==null?void 0:e.payload)==null?void 0:m.sweepstakeId}`);break}},reset(){this.initiated=!1,this.staticMessages=[],this.dynamicMessages=[],this.currentMessage=null},openGame(e){if(e)if(e.slug&&e.provider!=="Arena"){this.$router.push(`/games/${e.slug}`);return}else(e.provider==="Arena"||e.minigame===!0)&&this.openGameDirect(e,!1,"floating")}},watch:{isUserLogged(){this.reset(),this.feedInit()}}}),T=["innerHTML"];function E(e,s,t,i,a,o){return e.initiated&&e.currentMessage?(k(),b("div",{key:0,class:A(["activity-ticker bg-slate-900 overflow-hidden px-1 text-white flex items-center justify-center flex-wrap text-ellipsis relative py-0.5",{"pl-[--nav-left-width]":!e.isMobileNavOpen&&e.navState==="full","pl-[--nav-left-mini-width]":e.navState==="mini","xl:pr-[--chat-desktop-width]":!["hidden","disabled"].includes(e.chatState),"pr-[--chat-desktop-width]":["fullscreen"].includes(e.chatState)}])},[W(x,{name:"slidedown-fade-fast",mode:"out-in"},{default:N(()=>[(k(),b("button",{type:"button",class:"text-center md:line-clamp-1 text-scaled-to-container animate-slide-down-fade-in-fast truncate md:!text-sm cursor-pointer",key:e.currentMessage.id,innerHTML:e.currentMessage.text,onClick:s[0]||(s[0]=(...n)=>e.messageAction&&e.messageAction(...n))},null,8,T))]),_:1})],2)):C("",!0)}const U=G(_,[["render",E],["__scopeId","data-v-0a8d6afd"]]);export{U as _};
//# sourceMappingURL=Rotator.22a19886.js.map
