import{_ as P,a as U}from"./Entry.41454be2.js";import{f as _,q as m,u as p,_ as L,o as i,c as o,d as s,y as n,F as w,s as E,t as y,a as u,h as c,ak as I,w as T,g as C,A as N,k as v,D as $,m as k,i as S,al as D,n as M,T as B,N as O,O as R}from"./entry.4421f2c3.js";import{_ as A}from"./ButtonController.fa452612.js";import"./UserAvatar.35381a6a.js";import"./nuxt-link.8afd11c8.js";import"./CurrencyIconImage.f4cd812b.js";const H=_({name:"LeaderboardCoreMinigame",props:["tournament","pollingBlock","triggerUpdate","showHeaders"],data(){return{scheduleItem:null,leaderboardId:null,leaderboardData:null,scheduleData:null,ready:!1,isPlayerInEntries:!0,poller:null,take:3,skip:0,aroundCount:1,modes:[{name:"Leaderboard",id:"ranking",active:!0},{name:"Your Position",id:"position",active:!1}],containerMinHeight:0,scheduleTimeout:null}},computed:{activeMode(){return this.modes.find(e=>e.active===!0)},leaderboardScheduleName(){const{metadata:e}=this.tournament;return(e==null?void 0:e.leaderboardScheduleName)||!1},entries(){var a;let e=(a=this.leaderboardData)==null?void 0:a.entries;return!e||!e.length?[]:(e=e.map(t=>({...t,prizes:[]})),this.prizes.forEach(t=>{for(let r=t.startRank;r<=t.endRank;r++){const l=e.findIndex(f=>f.rank===r);l>-1&&e[l].prizes.push(t)}}),e)},prizes(){var e;return((e=this.leaderboardData)==null?void 0:e.prizes)||[]},pointDisplayType(){var e;return((e=this.leaderboardData)==null?void 0:e.pointDisplayType)||"Standard"},pointDisplayDecimals(){var e;return((e=this.leaderboardData)==null?void 0:e.pointDisplayDecimals)||0},metadata(){var e;return(e=this.leaderboardData)==null?void 0:e.metadata},pointsHeader(){var e;return((e=this.metadata)==null?void 0:e.pointsHeader)||"Score"}},mounted(){this.init()},beforeUnmount(){this.destroyPoller(),this.scheduleTimeout&&(clearTimeout(this.scheduleTimeout),this.scheduleTimeout=null)},methods:{...m(p,["openInfoCmsModal"]),async init(){var a;const e=(a=this.tournament.metadata)==null?void 0:a.leaderboardScheduleName;if(e){this.scheduleData=await this.getScheduleItem(e);const{leaderboardId:t}=this.scheduleData;this.leaderboardId=t}else this.tournament.leaderboardId&&(this.leaderboardId=this.tournament.leaderboardId);this.leaderboardId&&(await this.getLeaderboard(this.skip,this.take),this.ready=!0,this.startPolling())},async getScheduleItem(e){try{return await this.$api(`/leaderboard/schedule/${e}/item`,{method:"GET"})}catch(a){console.log(a)}},async getLeaderboard(){const e=this.activeMode.id;let a="";e==="ranking"?a=`/leaderboard/${this.leaderboardId}?&skip=${this.skip}&take=${this.take}`:e==="position"&&(a=`/leaderboard/${this.leaderboardId}/around?count=${this.aroundCount}`);try{let t=await this.$api(a,{method:"GET"});this.leaderboardData=t}catch(t){console.log(t)}},startPolling(){this.poller||(this.poller=setInterval(async()=>{this.pollingBlock||this.getLeaderboard()},5e3))},switchMode(){let e=this.activeMode.id==="ranking"?"position":"ranking";this.containerHeightUpdate(),this.modes=this.modes.map(a=>({...a,active:e===a.id})),this.getLeaderboard(),this.isPlayerInEntries=!0,this.destroyPoller(),this.startPolling()},destroyPoller(){this.poller&&(clearInterval(this.poller),this.poller=null)},containerHeightUpdate(){const e=this.$refs.container.offsetHeight;e>this.containerMinHeight&&(this.containerMinHeight=e)},openInfoModal(){this.leaderboardScheduleName&&this.openInfoCmsModal({modalId:this.leaderboardScheduleName})},async scheduleEnded(){this.destroyPoller(),this.scheduleTimeout=setTimeout(async()=>{this.ready=!1,this.init()},15e3)}},watch:{triggerUpdate(){this.getLeaderboard()},entries(){this.isPlayerInEntries=this.entries.find(e=>e.isPlayer)||!1}}}),W={key:0,class:"w-full animate-fade-in"},z={class:"px-1"},x={key:0,class:"flex justify-between items-center"},G={class:"flex items-center"},F={ref:"container"},j={class:"text-white text-center text-sm"},q={key:1,class:"animate-fade-in relative"},Y={key:0,class:"flex px-3 py-1 text-3xs uppercase text-green-500 font-bold sm:text-xs"},J=s("div",{class:"w-1/12"},[s("span",{class:"hidden sm:inline-block"},"Rank")],-1),K=s("div",{class:"w-4/12"},"Player",-1),Q=s("div",{class:"w-5/12"},"Prize",-1),X={class:"w-2/12 text-right"};function Z(e,a,t,r,l,f){var h;const b=P,g=U;return e.ready?(i(),o("div",W,[s("header",z,[e.scheduleData?(i(),o("div",x,[s("button",{class:n(["flex flex-nowrap relative overflow-hidden pl-1",{"mask-gradient-left":e.activeMode.id==="ranking","mask-gradient-right":e.activeMode.id==="position"}]),onClick:a[0]||(a[0]=d=>e.switchMode())},[s("div",{class:n(["uppercase font-bold tracking-wider leading-none flex flex-nowrap relative transition-all",{"translate-x-0 left-0":e.activeMode.id==="ranking","-translate-x-full left-full":e.activeMode.id==="position"}])},[(i(!0),o(w,null,E(e.modes,d=>(i(),o("div",{class:n(["uppercase tracking-wider text-sm transition-all whitespace-nowrap px-1 py-2",[d.active?"text-white":"text-slate-100"]])},y(d.name),3))),256))],2)],2),s("div",G,[u(b,{endTime:(h=e.scheduleData)==null?void 0:h.endTime,class:"mr-0.5",onEnded:e.scheduleEnded},null,8,["endTime","onEnded"]),s("button",{onClick:a[1]||(a[1]=d=>e.openInfoModal()),title:"Leaderboard information",class:"icon-ico-info text-lg rounded-full w-5 h-5 leading-none shrink-0 lg:h-full transition-colors bg-slate-500 hover:bg-slate-200"})])])):c("",!0)]),s("div",F,[e.activeMode.id==="position"&&!e.isPlayerInEntries||!e.entries.length?(i(),o("section",{key:0,class:"flex items-center justify-center animate-fade-in",style:I(`min-height: ${e.containerMinHeight}px`)},[s("p",j,y(e.entries.length?"You haven't entered the leaderboard yet":"No players yet... why not be the first one!"),1)],4)):e.entries.length>0?(i(),o("section",q,[e.showHeaders?(i(),o("div",Y,[J,K,Q,s("div",X,y(e.pointsHeader),1)])):c("",!0),u(N,{name:"list-position"},{default:T(()=>[(i(!0),o(w,null,E(e.entries,d=>(i(),C(g,{key:d.displayName,item:d,showPrize:!0,showProgress:!0,displayType:e.pointDisplayType,decimalPlaces:e.pointDisplayDecimals,metadata:e.metadata},null,8,["item","displayType","decimalPlaces","metadata"]))),128))]),_:1})])):c("",!0)],512)])):c("",!0)}const V=L(H,[["render",Z]]),ee=_({name:"MinigameMain",inject:["mq"],props:["displayMode"],data(){return{soundEnabled:!1,gameReady:!1,infoPanelOpen:!1,showLeaderboard:!1,leaderboardPollingBlock:!1,leaderboardTriggerUpdate:!0}},computed:{...v($,["isUserLogged"]),...v(p,["chatState"]),...k(p,["showErrorModal","errorModalType"]),...k(S,["balanceUpdateDuration","balanceBuffer","balanceUpdateEnabled"]),...k(D,["showGameContainer","gameSelected","entryData"]),mobileChatEnabled(){return!!(["fullscreen","minified"].includes(this.chatState)&&!this.mq.mdPlus)},gameUrl(){var e;return this.entryData?(e=this.entryData)==null?void 0:e.location:null}},mounted(){window.addEventListener("message",this.receiveMessage),this.checkLeaderboardDisplay()},unmounted(){window.removeEventListener("message",this.receiveMessage),this.enableBalanceUpdate(!0)},methods:{...m(D,["closeGame","loadTournaments"]),...m(S,["enableBalanceUpdate","balanceUpdate","loadWallet"]),...m(p,["openWalletModal"]),close(){if(this.infoPanelOpen){this.infoPanelOpen=!1,this.postMessage("INFO_CLOSE");return}this.gameReady=!1,this.showLeaderboard=!1,this.loadWallet(),this.closeGame()},openInfo(){this.postMessage("INFO_OPEN"),this.infoPanelOpen=!0},toggleSound(){return this.soundEnabled?this.postMessage("DISABLE_SOUND"):this.postMessage("ENABLE_SOUND")},postMessage(e){var t;return this.$refs.iframe.contentWindow.postMessage(e,"*"),this.$gtmCustomEvent({event:"game",action:e.toLowerCase(),gameId:(t=this.gameSelected)==null?void 0:t.id}),!0},receiveMessage(e){var t,r;const{data:a}=e;if(a.message)switch(a.message){case"READY":this.gameReady=!0,this.loadWallet();break;case"ROUND_START":this.enableBalanceUpdate(!1),this.leaderboardPollingBlock=!0;break;case"ROUND_COMPLETE":this.enableBalanceUpdate(!0),this.leaderboardPollingBlock=!1,this.leaderboardUpdate();break;case"BALANCE_UPDATE":this.enableBalanceUpdate(!0),this.balanceUpdateDuration=a.duration,this.leaderboardPollingBlock=!1,this.loadWallet();break;case"INFO_CLOSE":this.infoPanelOpen=!1;break;case"CLOSE":this.close();break;case"SOUND_ENABLED":this.soundEnabled=!0;break;case"SOUND_DISABLED":this.soundEnabled=!1;break;case"GAME_ENDED":this.loadTournaments();break;case"ERROR":this.loadWallet(),this.loadTournaments();break;case"BET_COMPLETE":this.loadWallet(),this.leaderboardUpdate();break;case"BET_ERROR":this.loadWallet();break;case"OPEN_URL":a!=null&&a.url&&M(a.url);break;case"OPEN_WALLET":this.openWalletModal("deposit");break;case"SWITCH_TO_FULLSCREEN":const l=(r=(t=this.gameSelected)==null?void 0:t.game)==null?void 0:r.slug;if(l)return this.close(),M(`/minigames/${l}`);this.errorModalType="General",this.showErrorModal=!0;break}},checkLeaderboardDisplay(){if(!this.gameSelected)return!1;const{metadata:e,leaderboardId:a}=this.gameSelected;this.showLeaderboard=!!(e!=null&&e.leaderboardScheduleName||a)},leaderboardUpdate(){this.leaderboardTriggerUpdate=!this.leaderboardTriggerUpdate}},watch:{gameSelected(e,a){(e==null?void 0:e.id)!==(a==null?void 0:a.id)&&(this.showLeaderboard=!1,this.gameReady=!1,this.leaderboardPollingBlock=!1,this.checkLeaderboardDisplay())},isUserLogged(e){e||(this.infoPanelOpen=!1,this.close())}}}),ae=["src"];function te(e,a,t,r,l,f){const b=V,g=A;return i(),o("div",{class:n({"z-30 top-0 h-1/2 pt-12 md:left-3 md:bottom-3 md:top-auto rounded-none":e.chatState==="minified","z-20 top-0 ":e.chatState==="fullscreen","z-20 bottom-0 shadow-2xl shadow-slate-900":["hidden","disabled","embedded"].includes(this.chatState)||!e.chatState,"fixed w-full left-0 bg-slate-800 rounded-xl overflow-hidden md:w-[400px] 3xl:w-[450px] 4xl:w-[550px] md:left-3 md:bottom-3 md:top-auto md:h-auto md:pt-0 md:shadow-2xl md:shadow-slate-900 md:rounded-xl shadow-md shadow-black":e.displayMode==="floating","w-full overflow-hidden":e.displayMode==="embedded"})},[u(B,{name:"slidedown-fade-fast",mode:"out-in"},{default:T(()=>{var h;return[e.showLeaderboard?(i(),o("div",{key:`key-${(h=e.gameSelected)==null?void 0:h.id}`,class:n(["relative bg-slate-700",[["fullscreen","minified"].includes(e.chatState)?"hidden md:block":""]])},[u(b,{tournament:e.gameSelected,pollingBlock:e.leaderboardPollingBlock,triggerUpdate:e.leaderboardTriggerUpdate},null,8,["tournament","pollingBlock","triggerUpdate"])],2)):c("",!0)]}),_:1}),s("div",{class:n(["relative h-full",[e.mobileChatEnabled?"md:pb-[66.8%]":"pb-[66.8%]"]])},[s("iframe",{ref:"iframe",id:"iframe",class:n(["w-full transition-all duration-200 translate-x-0 bg-slate-600 absolute left-0 top-0",[e.mobileChatEnabled?"h-full md:h-auto":"h-full",e.chatState==="fullscreen"&&e.mobileChatEnabled?"opacity-0":"opacity-100"]]),src:e.gameUrl},`
      `,10,ae),s("div",{class:n(["absolute z-20 top-2 right-2 flex items-center justify-end transition-all duration-500",[e.mobileChatEnabled?"top-16":"top-2"]])},[O(u(g,{iconClass:"icon-ico-x",iconSize:"text-xs",title:"Close",onClick:e.close},null,8,["onClick"]),[[R,!e.gameReady&&e.displayMode==="floating"]])],2)],2)],2)}const de=L(ee,[["render",te]]);export{de as default};
//# sourceMappingURL=Main.254dba74.js.map
