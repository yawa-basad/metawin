import{F as L,a as x,E as F,c as q,d as o,_ as B}from"./object.19c1d3e0.js";import{f as k,V as O,m as f,p as $,D as M,u as E,k as W,C as j,q as N,_ as S,r as z,o as t,g as p,w as c,d as i,t as P,a as y,N as Q,O as G,c as n,h as l,b,v as H,x as J}from"./entry.4421f2c3.js";import{_ as K}from"./VerificationCode.c96a2f44.js";import"./CurrencyIconImage.f4cd812b.js";import"./InputCode.444dd6a5.js";const X=k({name:"ModalAccountRegisterUpdate",components:{Form:L,Field:x,ErrorMessage:F},setup(){const{ACCOUNT_EMAIL_REQUIRED:e,ACCOUNT_EMAIL_UPDATE:a,ACCOUNT_USERNAME_REQUIRED:s,ACCOUNT_USERNAME_UPDATE:r}=O().public;return{emailRequired:e,emailUpdateEnabled:a,usernameRequired:s,usernameUpdateEnabled:r}},data(){return{debounce:null,formData:{username:"",email:""},meta:null,isUsernameAvailable:!0,isUsernameValid:!0,isLoading:!0,emailVerifyCode:null,error:null,emailValue:""}},mounted(){this.init()},unmounted(){this.freeEntryEmailVerify=!1},computed:{...f($,["userData","userProfile"]),...f(M,["isUserLogged","user"]),...f(E,["showInfoRegisterModal","freeEntryEmailVerify"]),...W(j,["isMobileDevice","browser"]),title(){return this.freeEntryEmailVerify?"Verify Email":"Welcome"},validationSchema(){return q().shape({email:o().when([],{is:()=>this.emailRequired,then:o().required(),otherwise:o().optional()}).email().label("Email"),username:o().when([],{is:()=>this.usernameRequired&&!this.freeEntryEmailVerify,then:o().required(),otherwise:o().optional()}).min(5,"Username is too short").test("usernameAvailable","Username is already taken",()=>this.isUsernameAvailable).test("usernameValid","Please choose a different username",()=>this.isUsernameValid).label("Username")})},canUpdateUsername(){var e;return!((e=this.userData)!=null&&e.displayName)||this.usernameUpdateEnabled&&this.usernameUpdateRestrictionExpired},canUpdateEmail(){var e,a;return!((e=this.userProfile)!=null&&e.email)||!((a=this.userProfile)!=null&&a.emailVerified)||this.emailUpdateEnabled&&this.emailUpdateRestrictionExpired},canUpdate(){return this.canUpdateUsername||this.canUpdateEmail},hasChanges(){var e,a;return this.formData.username!==((e=this.userData)==null?void 0:e.displayName)||this.formData.email!==((a=this.userProfile)==null?void 0:a.email)},usernameUpdateRestrictionExpired(){var e,a;return!((e=this.userData)!=null&&e.displayNameUpdateTime)||this.$dayjs((a=this.userData)==null?void 0:a.displayNameUpdateTime).isBefore(this.$dayjs().subtract(24,"hours"))},emailUpdateRestrictionExpired(){var e,a;return!((e=this.userProfile)!=null&&e.emailUpdateTime)||this.$dayjs((a=this.userProfile)==null?void 0:a.emailUpdateTime).isBefore(this.$dayjs().subtract(24,"hours"))}},methods:{...N($,["getUserData","getUserProfile","setUsername","updateUserProfile","syncUserProfile"]),...N(M,["logout","verifyEmail","verifyEmailCode"]),async init(){var e,a,s;await this.getUserProfile(),this.isLoading=!1,this.userData&&((e=this.userData)!=null&&e.displayName)&&(this.formData={username:(a=this.userData)==null?void 0:a.displayName,email:(s=this.userProfile)==null?void 0:s.email})},updateValues(e,a){this.meta=a,this.formData.username=e.username,this.formData.email=e.email},async debounceCheckDisplayName(){clearTimeout(this.debounce),this.debounce=setTimeout(async()=>{this.checkDisplayName()},500)},async checkDisplayName(){if(this.freeEntryEmailVerify)return!0;if(this.formData.username==="")return!1;try{const e=await this.$nuxt.$api("/user/display-name/check",{method:"POST",body:{name:this.formData.username}});this.isUsernameAvailable=e.available,this.isUsernameValid=e.valid,this.$refs.RegisterForm.validateField("username")}catch(e){console.log(e)}},async onSubmit(e){var a,s,r,m;this.isLoading=!0,this.error=null;try{this.canUpdateUsername&&e.username&&e.username!==((a=this.userData)==null?void 0:a.displayName)&&await this.setUsername(e.username),this.canUpdateEmail&&e.email&&e.email!==((s=this.userProfile)==null?void 0:s.email)?(await this.updateUserProfile({email:e.email}),this.$emit("register-submit")):this.showInfoRegisterModal=!1}catch(d){this.error=((m=(r=d.response)==null?void 0:r._data)==null?void 0:m.message)||d.message}finally{this.isLoading=!1}return!1},async refreshData(){this.getUserData(),this.getUserProfile()}}}),Y={class:"px-4 md:px-7 pt-4 w-full"},Z={class:"text-2xl tracking-wide font-semibold mb-2 text-center"},ee={key:0,class:"flex text-xs -mt-1.5"},ae=i("div",{class:"text-xs text-slate-50 leading-tight flex items-center"},[i("span",{class:"icon-ico-user text-base font-bold mr-0.5"}),i("span",null,"Proposed username. Feel free to customize.")],-1),te=[ae],se={class:"flex text-xs -mt-1"},ie={key:0,class:"text-slate-50 flex-auto text-right"},re=i("span",{class:"icon-ico-tick font-bold -top-[1px] relative align-middle z-10 text-green"},null,-1),oe={key:1,class:"text-green flex-auto text-right"},ne={key:1,class:"text-xs text-slate-50 leading-tight flex items-center"},le=i("span",{class:"icon-ico-info text-base font-bold mr-0.5"},null,-1),me=i("span",null,"Add your email to unlock premium access and free entry to prize competitions.",-1),de=[le,me],ue={key:2,class:"text-red text-center text-sm"};function he(e,a,s,r,m,d){const u=B,h=H,I=z("Form"),T=J;return t(),p(T,{onClose:e.close,dimClose:!0,bgCloseDisable:!0},{default:c(()=>[i("div",Y,[i("h1",Z,P(e.title),1),y(I,{onSubmit:e.onSubmit,"validation-schema":e.validationSchema,ref:"RegisterForm","initial-values":e.formData},{default:c(({values:g,meta:U})=>{var _,D,V,C,R,v,w;return[Q(y(u,{name:"username",type:"text",placeholder:"Username",autocomplete:"off",disabled:e.isLoading||!e.canUpdateUsername,value:(_=e.userData)==null?void 0:_.displayName,onInput:A=>{e.updateValues(g,U),e.debounceCheckDisplayName(g)}},null,8,["disabled","value","onInput"]),[[G,!e.freeEntryEmailVerify]]),e.canUpdateUsername&&e.formData.username===((D=e.userData)==null?void 0:D.displayName)&&!e.freeEntryEmailVerify?(t(),n("div",ee,te)):l("",!0),y(u,{name:"email",type:"email",placeholder:"Email",optional:!e.emailRequired,disabled:e.isLoading||!e.canUpdateEmail,value:(V=e.userProfile)==null?void 0:V.email,autocomplete:"off",onInput:A=>e.updateValues(g,U)},null,8,["optional","disabled","value","onInput"]),i("div",se,[(C=e.userProfile)!=null&&C.emailVerified?(t(),n("div",ie,[re,b(" Verified ")])):(t(),n("div",oe,[(R=e.userProfile)!=null&&R.email&&!((v=e.userProfile)!=null&&v.emailVerified)&&!e.hasChanges?(t(),p(h,{key:0,size:"2xs",type:"button",disabled:e.isLoading,onClick:a[0]||(a[0]=A=>e.$emit("register-submit"))},{default:c(()=>[b(" Verify ")]),_:1},8,["disabled"])):l("",!0)]))]),(w=e.userProfile)!=null&&w.email?l("",!0):(t(),n("div",ne,de)),e.error?(t(),n("div",ue,P(e.error),1)):l("",!0),e.canUpdate?(t(),p(h,{key:3,isLoading:e.isLoading,type:"submit",disabled:!U.valid||e.isLoading||!e.hasChanges,class:"block w-full mt-4"},{default:c(()=>[b(" Save changes ")]),_:2},1032,["isLoading","disabled"])):l("",!0)]}),_:1},8,["onSubmit","validation-schema","initial-values"])])]),_:1},8,["onClose"])}const ce=S(X,[["render",he]]),fe=k({name:"ModalAccountMain",data(){return{showVerifyEmailCode:!1}},computed:{...f(E,["showInfoRegisterModal","openWalletAfterRegister","freeEntryEmailVerify"])},methods:{onRegisterSubmit(){this.showVerifyEmailCode=!0},closeAccountVerificationModal(){this.showVerifyEmailCode=!1,console.log("closing"),this.freeEntryEmailVerify&&(console.log("closing 2"),this.showInfoRegisterModal=!1)},closeRegModal(){const e=E();this.showInfoRegisterModal=!1,this.openWalletAfterRegister?setTimeout(()=>{e.openWalletModal("deposit")},500):this.openWalletAfterRegister=!0}}});function pe(e,a,s,r,m,d){const u=ce,h=K;return t(),n("div",null,[y(u,{show:e.showInfoRegisterModal,onRegisterSubmit:e.onRegisterSubmit,onClose:e.closeRegModal},null,8,["show","onRegisterSubmit","onClose"]),e.showVerifyEmailCode?(t(),p(h,{key:0,attribute:"email",onClose:e.closeAccountVerificationModal},null,8,["onClose"])):l("",!0)])}const _e=S(fe,[["render",pe]]);export{_e as default};
//# sourceMappingURL=Main.2509aa3e.js.map
